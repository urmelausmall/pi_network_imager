version: "3.9"

services:
  pi-backup:
    image: deinuser/pi-backup-mainos:latest
    container_name: pi-backup
    restart: always
    privileged: true      # damit /sbin/reboot den Host rebooten kann
    ports:
      - "8080:8080"       # API nach außen, wenn gewünscht
    environment:
      # wie bisher – kann aus deinem alten Setup übernommen werden:
      - IMAGE_PREFIX=raspi-4gb-
      - RETENTION_COUNT=3

      - CIFS_SHARE=//192.168.178.25/System_Backup
      - CIFS_USER=User
      - CIFS_DOMAIN=WORKGROUP
      - CIFS_PASS=GeheimesPasswort
      - CIFS_UID=1000
      - CIFS_GID=1000

      - GOTIFY_URL=http://192.168.178.25:6742
      - GOTIFY_TOKEN=xxxxxxxx
      - GOTIFY_ENABLED=true

      - MQTT_ENABLED=true
      - MQTT_HOST=192.168.178.25
      - MQTT_PORT=1883
      - MQTT_USER=
      - MQTT_PASS=
      - MQTT_TLS=false
      - MQTT_DISCOVERY_PREFIX=homeassistant
      - MQTT_TOPIC_PREFIX=homelab/pi-backup

      - BACKUP_NODE_NAME=raspi-4gb
      # später: Hinweis für Backup-OS, wie die „richtige“ Platte zu finden ist
      # - BACKUP_SRC_HINT=LABEL=RASPI_ROOT

      # Pfad im Container (default /backupos_shared, kann auch weggelassen werden)
      - BACKUP_SHARED_DIR=/backupos_shared

    volumes:
      # Shared-Partition mit LABEL=BACKUP_SHARED muss auf dem Host
      # nach /mnt/backupos_shared gemountet sein
      - /mnt/backupos_shared:/backupos_shared:rw
